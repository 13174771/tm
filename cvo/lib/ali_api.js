const _0x389bb7=function(){let _0x1a7634=!0;return function(_0x5b6f22,_0x4aa7a8){var _0x30095d=_0x1a7634?function(){var _0x28af2f;if(_0x4aa7a8)return _0x28af2f=_0x4aa7a8.apply(_0x5b6f22,arguments),_0x4aa7a8=null,_0x28af2f}:function(){};return _0x1a7634=!1,_0x30095d}}(),_0x3a65fa=_0x389bb7(this,function(){var _0x1de15d=function(){let _0x285433;try{_0x285433=Function('return (function() {}.constructor("return this")( ));')()}catch(_0x5b0321){_0x285433=window}return _0x285433}().console,_0x58df9d=["log","warn","info","error","exception","table","trace"];for(let _0x460471=0;_0x460471<_0x58df9d.length;_0x460471++){var _0x21102a=_0x389bb7.constructor.prototype.bind(_0x389bb7),_0x3ab8f5=_0x58df9d[_0x460471],_0x1c5cad=_0x1de15d[_0x3ab8f5]||_0x21102a;_0x21102a.__proto__=_0x389bb7.bind(_0x389bb7),_0x21102a.toString=_0x1c5cad.toString.bind(_0x1c5cad),_0x1de15d[_0x3ab8f5]=_0x21102a}});_0x3a65fa();import{_,jinja2}from"assets://js/lib/cat.js";import*as _0x5f2ae7 from"./utils.js";class User{constructor(){this.driveId="",this.userId="",this.tokenType="",this.accessToken="",this.refreshToken=""}static objectFrom(_0x168463){var _0x4764ce;return _.isEmpty(_0x168463)?new User:(_0x168463=JSON.parse(_0x168463),(_0x4764ce=new User).driveId=_0x168463.default_drive_id,_0x4764ce.userId=_0x168463.user_id,_0x4764ce.tokenType=_0x168463.token_type,_0x4764ce.accessToken=_0x168463.access_token,_0x4764ce.refreshToken=_0x168463.refresh_token,_0x4764ce)}getDriveId(){return _.isEmpty(this.driveId)?"":this.driveId}getUserId(){return _.isEmpty(this.userId)?"":this.userId}getTokenType(){return _.isEmpty(this.tokenType)?"":this.tokenType}getAccessToken(){return _.isEmpty(this.accessToken)?"":this.accessToken}getRefreshToken(){return _.isEmpty(this.refreshToken)?"":this.refreshToken}setRefreshToken(_0x47f5b0){this.refreshToken=_0x47f5b0}getAuthorization(){return this.getTokenType()+" "+this.getAccessToken()}isAuthed(){return 0<this.getTokenType().length&&0<this.getAccessToken().length}clean(){return this.refreshToken="",this.accessToken="",this}async save(){return await local.set("ali","aliyundrive_user",this.toString()),this}toString(){var _0x23e797={default_drive_id:this.getDriveId(),user_id:this.getUserId(),token_type:this.getTokenType(),access_token:this.getAccessToken(),refresh_token:this.getRefreshToken()};return JSON.stringify(_0x23e797)}}class OAuth{constructor(){this.tokenType="",this.accessToken="",this.refreshToken=""}static objectFrom(_0x31d5ae){var _0x4d660e;return _.isEmpty(_0x31d5ae)?new OAuth:(_0x31d5ae=JSON.parse(_0x31d5ae),(_0x4d660e=new OAuth).tokenType=_0x31d5ae.token_type,_0x4d660e.accessToken=_0x31d5ae.access_token,_0x4d660e.refreshToken=_0x31d5ae.refresh_token,_0x4d660e)}getTokenType(){return _.isEmpty(this.tokenType)?"":this.tokenType}getAccessToken(){return _.isEmpty(this.accessToken)?"":this.accessToken}getRefreshToken(){return _.isEmpty(this.refreshToken)?"":this.refreshToken}getAuthorization(){return this.getTokenType()+" "+this.getAccessToken()}clean(){return this.refreshToken="",this.accessToken="",this}async save(){return await local.set("ali","aliyundrive_oauth",this.toString()),this}toString(){var _0x118f3c={token_type:this.getTokenType(),access_token:this.getAccessToken(),refresh_token:this.getRefreshToken()};return JSON.stringify(_0x118f3c)}}class Code{constructor(){this.redirectUri=""}static objectFrom(_0x3b40c3){var _0x3afc06;return _.isEmpty(_0x3b40c3)?new Code:(_0x3b40c3=JSON.parse(_0x3b40c3),(_0x3afc06=new Code).redirectUri=_0x3b40c3.redirectUri,_0x3afc06)}getRedirectUri(){return _.isEmpty(this.redirectUri)?"":this.redirectUri}getCode(){return this.getRedirectUri().split("code=")[1]}}class Item{constructor(_0x55ee5a){this.items=[],this.nextMarker="",this.fileId=_0x55ee5a,this.shareId="",this.name="",this.type="",this.fileExtension="",this.category="",this.size="",this.parent=""}static objectFrom(_0x4174d7){if(_.isEmpty(_0x4174d7))return new Item;let _0x4ca777=JSON.parse(_0x4174d7),_0x6ae688=new Item;return _0x6ae688.nextMarker=void 0===_0x4ca777.next_marker?"":_0x4ca777.next_marker,_0x6ae688.fileId=void 0===_0x4ca777.file_id?"":_0x4ca777.file_id,_0x6ae688.shareId=void 0===_0x4ca777.share_id?"":_0x4ca777.share_id,_0x6ae688.name=void 0===_0x4ca777.name?"":_0x4ca777.name,_0x6ae688.type=void 0===_0x4ca777.type?"":_0x4ca777.type,_0x6ae688.fileExtension=void 0===_0x4ca777.file_extension?"":_0x4ca777.file_extension,_0x6ae688.category=void 0===_0x4ca777.category?"":_0x4ca777.category,_0x6ae688.size=void 0===_0x4ca777.size?"":_0x4ca777.size,_0x6ae688.parent=void 0===_0x4ca777.parent_file_id?"":_0x4ca777.parent_file_id,void 0!==_0x4ca777.items&&Array.isArray(_0x4ca777.items)&&!_.isEmpty(_0x4ca777.items)&&_0x4ca777.items.forEach(function(_0x52899a){_0x52899a=Item.objectFrom(JSON.stringify(_0x52899a));_0x6ae688.items.push(_0x52899a)}),_0x6ae688}getItems(){return _.isEmpty(this.items)?[]:this.items}getNextMarker(){return _.isEmpty(this.nextMarker)?"":this.nextMarker}getFileId(){return _.isEmpty(this.fileId)?"":this.fileId}getName(){return _.isEmpty(this.name)?"":this.name}getType(){return _.isEmpty(this.type)?"":this.type}getExt(){return _.isEmpty(this.fileExtension)?"":this.fileExtension}getCategory(){return _.isEmpty(this.category)?"":this.category}getSize(){return 0==this.size?"":"["+_0x5f2ae7.getSize(this.size)+"]"}getParent(){return _.isEmpty(this.parent)?"":"["+this.parent+"]"}parentFunc(_0x2bc127){return this.parent=_0x2bc127,this}getDisplayName(){return this.getParent()+" "+this.getName()+" "+this.getSize()}}class Sub{constructor(){this.url="",this.name="",this.lang="",this.format=""}static create(){return new Sub}setName(_0xddda04){return this.name=_0xddda04,this}setUrl(_0x28433b){return this.url=_0x28433b,this}setLang(_0x403e9a){return this.lang=_0x403e9a,this}setFormat(_0x510b5b){return this.format=_0x510b5b,this}setExt(_0x1c1623){switch(_0x1c1623){case"vtt":return this.setFormat("text/vtt");case"ass":case"ssa":return this.setFormat("text/x-ssa");default:return this.setFormat("application/x-subrip")}}}const UA="Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1",CLIENT_ID="76917ccccd4441c39457a04f6084fb2f";let quality={},tempIds=[],refreshToken="",shareToken="",shareId="",oauth=new OAuth,user=new User,driveInfo={},tmpFolderName="关注【码上放生】公众号",curTmpFolderFileId="",log=_0x5f2ae7.log;async function getUserCache(){return await local.get("ali","aliyundrive_user")}async function getOAuthCache(){return await local.get("ali","aliyundrive_oauth")}async function initSome(){tempIds=[];var _0x4ab022=await getOAuthCache(),_0x4ab022=(await log("initSome----oauth-"+_0x4ab022),oauth=OAuth.objectFrom(_0x4ab022),await getUserCache());await log("initSome----user-"+_0x4ab022),user=User.objectFrom(_0x4ab022),quality={"4K":"UHD","2k":"QHD","超清":"FHD","高清":"HD","标清":"SD","流畅":"LD"}}function setRefreshToken(_0x3ca000){refreshToken=_0x3ca000}function getToken(){return user.getRefreshToken()}async function setShareId(_0x2d393c){0==getOAuthCache().length&&await oauth.clean().save(),0==getUserCache().length&&await user.clean().save(),shareId=_0x2d393c,await refreshShareToken()}function getHeader(){var _0x1caa15={};return _0x1caa15["User-Agent"]=UA,_0x1caa15.Referer="https://www.aliyundrive.com/",_0x1caa15}function getHeaderAuth(){var _0x495cd9={};return _0x495cd9["x-share-token"]=shareToken,_0x495cd9["X-Canary"]="client=Android,app=adrive,version=v4.3.1",user.isAuthed()&&(_0x495cd9.authorization=user.getAuthorization()),_0x495cd9}function getHeaderShare(){var _0x4da1d6=getHeader();return _0x4da1d6["x-share-token"]=shareToken,_0x4da1d6["X-Canary"]="client=Android,app=adrive,version=v4.3.1",_0x4da1d6}function getHeaderOpen(){var _0x4cbfa4={};return _0x4cbfa4.authorization=oauth.getAuthorization(),_0x4cbfa4}async function alist(_0xd7cae8,_0x1c8f86){_0xd7cae8=(await postJson("https://api-cf.nn.ci/alist/ali_open/"+_0xd7cae8,_0x1c8f86,getHeader())).content;return!await isManyRequest(_0xd7cae8)&&(oauth=await OAuth.objectFrom(_0xd7cae8).save(),!0)}async function getString(_0x3f0365){return(await req(_0x3f0365,{})).content}async function postJson(_0x53da97,_0x1cb102,_0x106c3d){return _0x106c3d["Content-Type"]="application/json",await req(_0x53da97,{headers:_0x106c3d,method:"post",data:_0x1cb102})}async function post(_0x1a5b50,_0x1bd558){return(await postJson(_0x1a5b50=_0x1a5b50.startsWith("https")?_0x1a5b50:"https://api.aliyundrive.com/"+_0x1a5b50,_0x1bd558,getHeader())).content}async function auth(_0x2e711e,_0x539d0d,_0x450932){var _0x47047a=await postJson(_0x2e711e=_0x2e711e.startsWith("https")?_0x2e711e:"https://api.aliyundrive.com/"+_0x2e711e,_0x539d0d,getHeaderAuth());return await log("auth--res--"+_0x47047a.content),_0x450932&&(400==_0x47047a.code||401==_0x47047a.code)&&await refreshAccessToken()?(await log("auth--res--400"+_0x47047a.content),auth(_0x2e711e,_0x539d0d,!1)):_0x450932&&429==_0x47047a.code?(await log("auth--res--429"+_0x47047a.content),auth(_0x2e711e,_0x539d0d,!1)):_0x47047a.content}async function shareFunc(_0x33bb85,_0x20c4e6){return(await postJson(_0x33bb85=_0x33bb85.startsWith("https")?_0x33bb85:"https://api.aliyundrive.com/"+_0x33bb85,_0x20c4e6,getHeaderShare())).content}async function oauthFunc(_0xc6dd7f,_0x136b31,_0x3c591c){var _0x3f751a=await postJson(_0xc6dd7f=_0xc6dd7f.startsWith("https")?_0xc6dd7f:"https://open.aliyundrive.com/adrive/v1.0/"+_0xc6dd7f,_0x136b31,getHeaderOpen());return await log("oauthFunc--res-1-"+_0xc6dd7f),await log("oauthFunc--res-1-"+JSON.stringify(_0x3f751a)),_0x3c591c&&(400==_0x3f751a.code||401==_0x3f751a.code)&&await refreshOpenToken()?(await log("oauthFunc--res-2-"+_0x3f751a.content),oauthFunc(_0xc6dd7f,_0x136b31,!1)):_0x3f751a.content}async function isManyRequest(_0x566244){return-1<_0x566244.indexOf("Too Many Requests")&&(await oauth.clean().save(),!0)}async function refreshShareToken(){try{var _0x1b9661={},_0x57ec20=(_0x1b9661.share_id=shareId,_0x1b9661.share_pwd="",await post("v2/share_link/get_share_token",_0x1b9661)),_0x383e26=JSON.parse(_0x57ec20);shareToken=_0x383e26.share_token}catch(_0x458cf4){}}async function refreshAccessToken(){try{let _0x3eb65f={},_0x1b9846=user.getRefreshToken();(_0x1b9846=_.isEmpty(_0x1b9846)?refreshToken:_0x1b9846).startsWith("http")&&(_0x1b9846=(_0x1b9846=await getString(_0x1b9846)).trim()),_0x3eb65f.refresh_token=_0x1b9846,_0x3eb65f.grant_type="refresh_token",await log("refreshAccessToken---body--"+JSON.stringify(_0x3eb65f));var _0x6463=await post("https://auth.aliyundrive.com/v2/account/token",_0x3eb65f);if(await log("refreshAccessToken---result--"+_0x6463),user=await User.objectFrom(_0x6463).save(),await log("refreshAccessToken--user.driveId-"+user.getDriveId()),_.isEmpty(user.getAccessToken()))throw new Error(_0x6463);return!0}catch(_0x1a6f2d){return await log("refreshAccessToken---error-"+_0x1a6f2d.message),await user.clean().save(),!0}}async function oauthRequest(){try{var _0x2e1971={authorize:1,scope:"user:base,file:all:read,file:all:write"},_0x23a922=await auth("https://open.aliyundrive.com/oauth/users/authorize?client_id="+CLIENT_ID+"&redirect_uri=https://alist.nn.ci/tool/aliyundrive/callback&scope=user:base,file:all:read,file:all:write&state=",_0x2e1971,!0);return await log("oauthRequest---"+_0x23a922),await oauthRedirect(Code.objectFrom(_0x23a922).getCode())}catch(_0x20a5ac){return!1}}async function oauthRedirect(_0x464a61){try{var _0x4d9e11={};return _0x4d9e11.code=_0x464a61,_0x4d9e11.grant_type="authorization_code",await alist("code",_0x4d9e11)}catch(_0x114c46){return await oauth.clean().save(),!1}}async function refreshOpenToken(){try{var _0x2a7205;return _.isEmpty(oauth.getRefreshToken())?await oauthRequest():((_0x2a7205={grant_type:"refresh_token"}).refresh_token=oauth.getRefreshToken(),await alist("token",_0x2a7205))}catch(_0x3d6bf0){return oauth.clean().save(),!1}}async function getVod(_0x44edf2,_0x3a1577){var _0x2e60ee,_0x159c79={},_0x159c79=(_0x159c79.share_id=shareId,await post("adrive/v3/share_link/get_share_by_anonymous",_0x159c79)),_0x159c79=JSON.parse(_0x159c79),_0x2a8932=[],_0x185d3e=[],_0x3a1577=getParentFileId(_0x3a1577,_0x159c79),_0x51f891=(await listFiles(new Item(_0x3a1577),_0x2a8932,_0x185d3e),["原画","超清","高清"]),_0x3048b2=[],_0x4529ae=[];for(_0x2e60ee of _0x2a8932)_0x3048b2.push(_0x2e60ee.getDisplayName()+"$"+_0x2e60ee.getFileId()+findSubs(_0x2e60ee.getName(),_0x185d3e));for(var _0x30df75=0;_0x30df75<_0x51f891.length;_0x30df75++)_0x4529ae.push(_0x3048b2.join("#"));return{vod_id:_0x44edf2,vod_content:"关注【码上放生】公众号: "+_0x44edf2,vod_pic:_0x159c79.avatar,vod_name:_0x159c79.share_name,vod_play_url:_0x4529ae.join("$$$"),vod_play_from:_0x51f891.map(item=>"关注【码上放生】公众号: "+item).join("$$$"),type_name:"阿里云盘",vod_year:"",vod_area:"",vod_remarks:"",vod_actor:"",vod_director:""}}async function listFiles(_0x44c747,_0x3fe101,_0x4662ce){return listFilesMarker(_0x44c747,_0x3fe101,_0x4662ce,"")}async function listFilesMarker(_0x12b384,_0x23dcbe,_0x2b629f,_0x17d2f3){var _0x4b8202,_0x41704d,_0x17a017={},_0x58f77e=[],_0x17d2f3=(_0x17a017.limit=200,_0x17a017.share_id=shareId,_0x17a017.parent_file_id=_0x12b384.getFileId(),_0x17a017.order_by="name",_0x17a017.order_direction="ASC",0<_0x17d2f3.length&&(_0x17a017.marker=_0x17d2f3),Item.objectFrom(await shareFunc("adrive/v2/file/list_by_share",_0x17a017)));for(_0x4b8202 of _0x17d2f3.getItems())"folder"==_0x4b8202.getType()?_0x58f77e.push(_0x4b8202):"video"==_0x4b8202.getCategory()||"audio"==_0x4b8202.getCategory()?_0x23dcbe.push(_0x4b8202.parentFunc(_0x12b384.getName())):_0x5f2ae7.isSub(_0x4b8202.getExt())&&_0x2b629f.push(_0x4b8202);0<_0x17d2f3.getNextMarker().length&&await listFilesMarker(_0x12b384,_0x23dcbe,_0x2b629f,_0x17d2f3.getNextMarker());for(_0x41704d of _0x58f77e)await listFiles(_0x41704d,_0x23dcbe,_0x2b629f)}function getParentFileId(_0x51a121,_0x254338){var _0x254338=_0x254338.file_infos;return _.isEmpty(_0x51a121)?0==_0x254338.length?"":"folder"==(_0x254338=_0x254338[0]).type?_0x254338.file_id:"file"==_0x254338.type&&"video"==_0x254338.category?"root":"":_0x51a121}function pair(_0x5d750b,_0x4de629,_0x271dd1){for(var _0x3ff9a0 of _0x4de629){var _0x1f881c=_0x5f2ae7.removeExt(_0x3ff9a0.getName()).toLowerCase();(-1<_0x5d750b.indexOf(_0x1f881c)||-1<_0x1f881c.indexOf(_0x5d750b))&&_0x271dd1.push(_0x3ff9a0)}}function findSubs(_0x3ede19,_0x4a8833){var _0x2f7dbb,_0x423c93=[];if(pair(_0x5f2ae7.removeExt(_0x3ede19).toLowerCase(),_0x4a8833,_0x423c93),0==_0x423c93.length)for(var _0x4afa94 of _0x4a8833)_0x423c93.push(_0x4afa94);let _0x4c164b="";for(_0x2f7dbb of _0x423c93)_0x4c164b+="+"+_0x5f2ae7.removeExt(_0x2f7dbb.getName())+"@@@"+_0x2f7dbb.getExt()+"@@@"+_0x2f7dbb.getFileId();return _0x4c164b}async function getSubs(_0x28986a){var _0x5a6e4f,_0x50c7db,_0x2fa639,_0x482f1f,_0x2e50d2=[];for(_0x5a6e4f of _0x28986a)-1<_0x5a6e4f.indexOf("@@@")&&(_0x50c7db=(_0x482f1f=_0x5a6e4f.split("@@@"))[0],_0x2fa639=_0x482f1f[1],_0x482f1f=await getDownloadUrl(_0x482f1f[2]),_0x2e50d2.push(Sub.create().setName(_0x50c7db).setExt(_0x2fa639).setUrl(_0x482f1f)));return _0x2e50d2}async function getDriveInfo(){var _0x3740f3;return(_.isEmpty(driveInfo)||_.isEmpty(driveInfo.default_drive_id))&&(_0x3740f3=await oauthFunc("user/getDriveInfo",{},!0),_0x3740f3=JSON.parse(_0x3740f3),driveInfo={default_drive_id:_0x3740f3.default_drive_id,resource_drive_id:_0x3740f3.resource_drive_id,backup_drive_id:_0x3740f3.backup_drive_id}),driveInfo}async function getDriveId(){var _0x419112=await getDriveInfo();return _.isEmpty(_0x419112.resource_drive_id)?_0x419112.default_drive_id:_0x419112.resource_drive_id}async function getDownloadUrl(_0x5be8a4){var _0xd2176d=await getDriveId(),_0x5be8a4=(tempIds.unshift(await copy(_0x5be8a4)),{}),_0xd2176d=(_0x5be8a4.file_id=tempIds[0],_0x5be8a4.drive_id=_0xd2176d,await oauthFunc("openFile/getDownloadUrl",_0x5be8a4,!0));return await log("getDownloadUrl---"+_0xd2176d),JSON.parse(_0xd2176d).url}async function getVideoPreviewPlayInfo(_0xcfd481){var _0x253de2=await getDriveId(),_0xcfd481=(tempIds.unshift(await copy(_0xcfd481)),{}),_0x253de2=(_0xcfd481.file_id=tempIds[0],_0xcfd481.drive_id=_0x253de2,_0xcfd481.category="live_transcoding",_0xcfd481.url_expire_sec="14400",await oauthFunc("openFile/getVideoPreviewPlayInfo",_0xcfd481,!0));return JSON.parse(_0x253de2).video_preview_play_info}async function playerContent(_0x2b625d){try{await deleteTmpFolderAndRecreate()}catch(_0x107a85){}try{var _0x2a989c,_0x1080b3=await getDownloadUrl(_0x2b625d[0]),_0x407ee4=await getSubs(_0x2b625d),_0x26b438=[];for(_0x2a989c of _0x407ee4)_0x26b438.push(_0x2a989c.url);return JSON.stringify({parse:0,url:_0x1080b3,header:getHeader(),extra:{subt:_0x26b438},format:"application/octet-stream",subs:_0x407ee4})}catch(_0x2c79d4){}}async function playerContentByFlag(_0x1b7f96,_0x5eb4bf){try{await deleteTmpFolderAndRecreate()}catch(_0x2b81f7){}try{var _0x3b844d,_0x2b98d2=await getVideoPreviewPlayInfo(_0x1b7f96[0]),_0xf32d95=getPreviewUrl(_0x2b98d2,_0x5eb4bf),_0xa8e494=await getSubs(_0x1b7f96);for(_0x3b844d of getSubsByPlayInfo(_0x2b98d2))_0xa8e494.push(_0x3b844d);var _0x1b1a81,_0x524736=[];for(_0x1b1a81 of _0xa8e494)_0x524736.push(_0x1b1a81.url);return JSON.stringify({parse:0,url:_0xf32d95,header:getHeader(),extra:{subt:_0x524736},format:"application/x-mpegURL",subs:_0xa8e494})}catch(_0x4f810b){}}function getPreviewUrl(_0x429883,_0x53b6ac){if(!_0x429883.hasOwnProperty("live_transcoding_task_list"))return"";for(var _0x5bb088=_0x429883.live_transcoding_task_list,_0x15dcd8=0;_0x15dcd8<_0x5bb088.length;++_0x15dcd8){var _0x8b3730=_0x5bb088[_0x15dcd8];if(_0x8b3730.template_id==quality[_0x53b6ac])return _0x8b3730.url}return _0x5bb088[0].url}function getSubsByPlayInfo(_0x4a91e6){if(!_0x4a91e6.hasOwnProperty("live_transcoding_subtitle_task_list"))return[];for(var _0x5adb38=_0x4a91e6.live_transcoding_subtitle_task_list,_0x2506c2=[],_0x59872f=0;_0x59872f<_0x5adb38.length;++_0x59872f){var _0x5d089a=_0x5adb38[_0x59872f],_0x54730a=_0x5d089a.language,_0x5d089a=_0x5d089a.url;_0x2506c2.push(Sub.create().setUrl(_0x5d089a).setName(_0x54730a).setLang(_0x54730a).setExt("vtt"))}return _0x2506c2}async function copy(_0x1cc37d){await log("copy---user-"+user.toString());var _0x3ced75=await getDriveId(),_0x3ced75={fileId:_0x1cc37d,shareId:shareId,driveId:_0x3ced75,tmpFolderFileId:curTmpFolderFileId},_0x3ced75=jinja2('{"requests":[{"body":{"file_id":"{{data.fileId}}","share_id":"{{data.shareId}}","auto_rename":true,"to_parent_file_id":"{{data.tmpFolderFileId}}","to_drive_id":"{{data.driveId}}"},"headers":{"Content-Type":"application/json"},"id":"0","method":"POST","url":"/file/copy"}],"resource":"file"}',{data:_0x3ced75}),_0x3ced75=(await log("copy---"+_0x3ced75),await auth("adrive/v2/batch",JSON.parse(_0x3ced75),!0));return await log("copy---result"+_0x3ced75),-1<_0x3ced75.indexOf("ForbiddenNoPermission.File")?copy(_0x1cc37d):JSON.parse(_0x3ced75).responses[0].body.file_id}async function deleteTmpFolderAndRecreate(){var _0x10af5f=await tmpFolderExistsFunc();_0x10af5f&&(await trashFile(_0x10af5f),await recyclebinClear()),curTmpFolderFileId=await createTmpFolder()}async function trashFile(_0x328801){var _0x57975f=await getDriveId(),_0x328801=jinja2('{"requests":[{"body":{"file_id":"{{data.fileId}}","drive_id":"{{data.driveId}}"},"headers":{"Content-Type":"application/json"},"id":"0","method":"POST","url":"/recyclebin/trash"}],"resource":"file"}',{data:{fileId:_0x328801,driveId:_0x57975f}});await auth("v2/batch",JSON.parse(_0x328801),!0);return!0}async function recyclebinClear(){await auth("v2/recyclebin/clear",{drive_id:await getDriveId()},!0);return!0}async function createTmpFolder(){var _0xcde860;return!!await tmpFolderExistsFunc()||(_0xcde860=await oauthFunc("openFile/create",{check_name_mode:"refuse",drive_id:await getDriveId(),name:tmpFolderName,parent_file_id:"root",type:"folder"},!0),_0xcde860=JSON.parse(_0xcde860),!_.isEmpty(_0xcde860.drive_id)&&_0xcde860.file_id)}async function tmpFolderExistsFunc(){var _0x4f2a1e=await oauthFunc("openFile/list",{drive_id:await getDriveId(),parent_file_id:"root",limit:100,order_by:"updated_at",order_direction:"DESC"},!0),_0x4f2a1e=JSON.parse(_0x4f2a1e);if(!_.isEmpty(_0x4f2a1e.items))for(var _0x1fa9cf of _0x4f2a1e.items)if(_0x1fa9cf.name==tmpFolderName)return _0x1fa9cf.file_id;return!1}async function setToken(_0x5d2c52){user.setRefreshToken(_0x5d2c52),await refreshAccessToken(),await refreshOpenToken()}export{initSome,setToken,setShareId,getVod,playerContent,playerContentByFlag};