import{load,_,Uri}from"assets://js/lib/cat.js";import{log}from"./lib/utils.js";import{initAli,detailContent,playContent}from"./lib/ali.js";let siteKey="wogg",siteType=0,siteUrl="https://wogg.link",UA="Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1",patternAli=/(https:\/\/www\.aliyundrive\.com\/s\/[^"]+)/;async function init(cfg){try{console.log(cfg.skey,cfg.stype,cfg.ext),siteKey=_.isEmpty(cfg.skey)?"":cfg.skey,siteType=_.isEmpty(cfg.stype)?"":cfg.stype,await initAli(cfg)}catch(e){await log("init:"+e.message+" line:"+e.lineNumber)}}async function request(reqUrl,agentSp){var agentSp={"user-agent":agentSp||"okhttp/3.12.0"},uri=new Uri(reqUrl),uri=await req(uri.toString(),{headers:agentSp,timeout:1e4}),agentSp=(console.log("=== request URL === "+reqUrl),uri.content);return console.log("=== request RESULT === "+agentSp),agentSp}function getHeader(){var header={};return header["User-Agent"]=UA,header}async function getString(url){return(await req(url,{headers:getHeader()})).content}let classes=[{type_id:1,type_name:"码上看电影"},{type_id:20,type_name:"码上看电视剧"},{type_id:28,type_name:"码上看综艺"},{type_id:24,type_name:"码上看动漫"},{type_id:32,type_name:"码上看音乐"}],filterObj={};async function home(filter){return JSON.stringify({class:classes,filters:filterObj})}async function homeVod(){return"{}"}async function category(tid,pg,filter,extend){var item,tid=await request(siteUrl+"/index.php/vodshow/"+tid+"--------"+pg+"---.html",UA),$=load(tid),videos=[];for(item of $(".module:eq(0) > .module-list > .module-items > .module-item")){var oneA=$(item).find(".module-item-cover .module-item-pic a").first(),href=oneA.attr("href"),oneA=oneA.attr("title"),pic=$(item).find(".module-item-cover .module-item-pic img").first().attr("data-src"),remark=$(item).find(".module-item-text").first().text();videos.push({vod_id:href,vod_name:oneA,vod_pic:pic,vod_remarks:remark})}tid=0<$("#page > a:contains(下一页)").length?parseInt(pg)+1:parseInt(pg);return JSON.stringify({page:parseInt(pg),pagecount:tid,limit:72,total:72*tid,list:videos})}async function detail(id){try{await log("detail:id:---"+id);var matches,preMatches=id.match(patternAli);return _.isEmpty(preMatches)?(matches=(await getString(siteUrl+id)).match(patternAli),console.log("detailmatche---"),console.log(matches[1]),_.isEmpty(matches)?"":await detailContent(matches[1])):await detailContent(preMatches[1])}catch(e){await log("detail:"+e.message+" line:"+e.lineNumber)}}async function play(flag,id,flags){try{return await playContent(flag,id,flags)}catch(e){await log("play:"+e.message+" line:"+e.lineNumber)}}async function search(wd,quick){await log("search---"+wd);var item,wd=await getString(siteUrl+"/index.php/vodsearch/-------------.html?wd="+wd),$=load(wd),videos=[];for(item of $(".module-search-item")){var vodId=$(item).find(".video-serial")[0].attribs.href,name=$(item).find(".video-serial")[0].attribs.title,pic=$(item).find(".module-item-pic > img")[0].attribs["data-src"];videos.push({vod_id:vodId,vod_name:name,vod_pic:pic,vod_remarks:""})}return JSON.stringify({list:videos})}function __jsEvalReturn(){return{init:init,home:home,homeVod:homeVod,category:category,detail:detail,play:play,search:search}}export{__jsEvalReturn};